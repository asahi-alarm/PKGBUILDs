From fdef10916ee61e4440189b9fad5d09c6295b7a71 Mon Sep 17 00:00:00 2001
From: Eric Engestrom <eric@igalia.com>
Date: Wed, 29 Oct 2025 18:25:03 +0100
Subject: [PATCH] asahi/virtio: fix memleak

Fixes: c64a2bbff5a3370bca7f ("asahi: port to stable uAPI")
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/38149>
---
 src/asahi/lib/agx_device_virtio.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/asahi/lib/agx_device_virtio.c b/src/asahi/lib/agx_device_virtio.c
index e245c0c7c97c5..27fc522d9999b 100644
--- a/src/asahi/lib/agx_device_virtio.c
+++ b/src/asahi/lib/agx_device_virtio.c
@@ -133,6 +133,7 @@ agx_virtio_bo_bind(struct agx_device *dev, struct drm_asahi_gem_bind_op *ops,
    memcpy(req->payload, ops, payload_size);
 
    int ret = vdrm_send_req(dev->vdrm, &req->hdr, false);
+   free(req);
    if (ret) {
       fprintf(stderr, "ASAHI_CCMD_GEM_BIND failed: %d\n", ret);
    }
-- 
GitLab

